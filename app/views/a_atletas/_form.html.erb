<%= simple_form_for(@a_atleta) do |f| %>
  <div class="form-wizard">
    <!-- Header do Wizard -->
    <div class="wizard-header">
      <div class="wizard-steps">
        <div class="wizard-step active">
          <div class="step-number">1</div>
          <span>Dados Pessoais</span>
        </div>
        <div class="wizard-step">
          <div class="step-number">2</div>
          <span>Responsável & Endereço</span>
        </div>
        <div class="wizard-step">
          <div class="step-number">3</div>
          <span>Configurações</span>
        </div>
      </div>
      <div class="wizard-progress">
        <div class="wizard-progress-bar"></div>
      </div>
    </div>
    <!-- Conteúdo do Formulário -->
    <div class="wizard-content">
      <%= f.error_notification %>
      <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
      <!-- Etapa 1: Dados Pessoais -->
      <div class="wizard-step-content active" id="step1">
        <div class="form-section">
          <h3 class="section-title">
            <i data-lucide="user" style="width: 18px; height: 18px;"></i>
            Informações Pessoais do Atleta
          </h3>
          <div class="form-row">
            <div class="form-group">
              <%= f.input :nome, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Nome Completo" %>
            </div>
            <div class="form-group">
              <%= f.input :cpf, input_html: { class: "form-input", maxlength: "11",  pattern: "\\d*", inputmode: "numeric" }, label_html: { class: "form-label" },placeholder: "000.000.000-00" %>
            </div>
            <div class="form-group">
              <%= f.input :data_nascimento, as: :date, start_year: 1900, end_year: Date.today.year, order: [:day, :month, :year],label_html: { class: "form-label" } %>
            </div>
            <div class="form-group">
              <%= f.input :nacionalidade, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Nacionalidade" %>
            </div>
            <div class="form-group">
              <%= f.association :a_sexo, collection: ASexo.all.order(:descricao), label_method: :descricao, value_method: :id, input_html: { class: "form-select" },label_html: { class: "form-label" },prompt: "Selecione o sexo" %>
            </div>
            <div class="form-group">
              <%= f.input :contato1, input_html: {   class: "form-input",   maxlength: "11",   pattern: "\\d{10,11}",   inputmode: "numeric",   oninput: "this.value = this.value.replace(/\\D/g, '')" }, label_html: { class: "form-label" }, placeholder: "(00) 00000-0000" %>
            </div>
            <div class="form-group">
              <%= f.input :contato2, input_html: {   class: "form-input",   maxlength: "11",   pattern: "\\d{10,11}",   inputmode: "numeric",   oninput: "this.value = this.value.replace(/\\D/g, '')" }, label_html: { class: "form-label" }, placeholder: "(00) 00000-0000" %>
            </div>
            <div class="form-group">
              <%= f.input :foto_atleta, as: :file, input_html: { accept: 'image/*', class: "form-input" },label_html: { class: "form-label" },label: "Foto do Atleta" %>
            </div>
          </div>
        </div>
        <div class="form-section">
          <h3 class="section-title">
            <i data-lucide="users" style="width: 18px; height: 18px;"></i>
            Filiação
          </h3>
          <div class="form-row">
            <div class="form-group">
              <%= f.input :nome_pai, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Nome do Pai" %>
            </div>
            <div class="form-group">
              <%= f.input :nome_mae, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Nome da Mãe" %>
            </div>
          </div>
        </div>
      </div>
      <!-- Etapa 2: Responsável & Endereço -->
      <div class="wizard-step-content" id="step2" style="display: none;">
        <div class="form-section">
          <h3 class="section-title">
            <i data-lucide="shield-check" style="width: 18px; height: 18px;"></i>
            Dados do Responsável
          </h3>
          <div class="form-row">
            <div class="form-group">
              <%= f.input :responsavel_nome, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Nome do Responsável" %>
            </div>
            <div class="form-group">
              <%= f.input :responsavel_cpf, input_html: { class: "form-input", maxlength: "11", pattern: "\\d{11}",    inputmode: "numeric",  },  label_html: { class: "form-label" },  placeholder: "000.000.000-00" %>
            </div>
            <div class="form-group">
              <%= f.input :responsavel_rg, input_html: { class: "form-input" }, label_html: { class: "form-label" },placeholder: "00.000.000-0" %>
            </div>
            <div class="form-group full-width">
              <%= f.input :responsavel_orientacao, as: :text,input_html: { class: "form-textarea", rows: 3 }, label_html: { class: "form-label" },placeholder: "Orientações do responsável" %>
            </div>
          </div>
        </div>
        <div class="form-section">
          <h3 class="section-title">
            <i data-lucide="map-pin" style="width: 18px; height: 18px;"></i>
            Endereço
          </h3>
          <div class="form-row">
            <div class="form-group">
              <%= f.input :cep, input_html: { class: "form-input" }, label_html: { class: "form-label" },placeholder: "00000-000" %>
            </div>
            <div class="form-group">
              <%= f.input :rua, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Nome da Rua" %>
            </div>
            <div class="form-group">
              <%= f.input :numero, input_html: { class: "form-input" }, label_html: { class: "form-label" },placeholder: "Número" %>
            </div>
            <div class="form-group">
              <%= f.input :bairro, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Bairro" %>
            </div>
            <div class="form-group">
              <%= f.association :g_estado, collection: GEstado.all.order(:nome_fantasia), label_method: :nome_fantasia, value_method: :id, input_html: { class: "form-select" },label_html: { class: "form-label" },prompt: "Selecione o estado" %>
            </div>
            <div class="form-group">
              <%= f.association :g_cidade, collection: GCidade.all.order(:nome_fantasia), label_method: :nome_fantasia, value_method: :id, input_html: { class: "form-select" },label_html: { class: "form-label" },prompt: "Selecione a cidade" %>
            </div>
            <div class="form-group full-width">
              <%= f.input :complemento, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Complemento (Apartamento, Bloco, etc.)" %>
            </div>
          </div>
        </div>
      </div>
      <!-- Etapa 3: Configurações -->
      <div class="wizard-step-content" id="step3" style="display: none;">
        <div class="form-section">
          <h3 class="section-title">
            <i data-lucide="settings" style="width: 18px; height: 18px;"></i>
            Configurações de Treinamento
          </h3>
          <div class="form-row">
            <div class="form-group">
              <%= f.association :a_unidade_treinamento, collection: AUnidadeTreinamento.all.order(:descricao), label_method: :descricao, value_method: :id, input_html: { class: "form-select" },label_html: { class: "form-label" },prompt: "Selecione a unidade de treinamento" %>
            </div>
          </div>
        </div>
        <div class="form-section">
          <h3 class="section-title">
            <i data-lucide="heart" style="width: 18px; height: 18px;"></i>
            Necessidades Especiais
          </h3>
          <div class="form-row">
            <div class="form-group full-width">
              <%= f.input :portador_necessidade, input_html: { class: "form-input capitalize" }, label_html: { class: "form-label" },placeholder: "Portador de necessidade especial?" %>
            </div>
            <div class="form-group full-width">
              <%= f.input :descricao_necessidade, as: :text,input_html: { class: "form-textarea", rows: 4 }, label_html: { class: "form-label" },placeholder: "Descreva as necessidades especiais ou observações médicas" %>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Ações do Wizard -->
    <div class="wizard-actions">
      <div class="btn-group">
        <button type="button" class="modern-btn modern-btn-outline" id="prevBtn" style="display: none;">
          <i data-lucide="chevron-left" style="width: 14px; height: 14px;"></i>
          Anterior
        </button>
      </div>
      <div class="btn-group">
        <%= link_to a_atletas_path, class: "modern-btn modern-btn-outline" do %>
          <i data-lucide="x" style="width: 14px; height: 14px;"></i>
          Cancelar
        <% end %>
        <button type="button" class="modern-btn modern-btn-primary" id="nextBtn">
          Próximo
          <i data-lucide="chevron-right" style="width: 14px; height: 14px;"></i>
        </button>
        <button type="submit" class="modern-btn modern-btn-success" id="submitBtn" style="display: none;">
          <i data-lucide="save" style="width: 14px; height: 14px;"></i>
          <%= @a_atleta.new_record? ? 'Criar' : 'Salvar' %> Atleta
        </button>
      </div>
    </div>
  </div>
  <script>
    let currentStep = 1;
    const totalSteps = 3;

    function showStep(step) {
      // Esconder todas as etapas
      document.querySelectorAll('.wizard-step-content').forEach(content => {
        content.style.display = 'none';
      });

      // Mostrar etapa atual
      document.getElementById(`step${step}`).style.display = 'block';

      // Atualizar indicadores visuais
      document.querySelectorAll('.wizard-step').forEach((stepEl, index) => {
        stepEl.classList.remove('active', 'completed');
        if (index + 1 < step) {
          stepEl.classList.add('completed');
        } else if (index + 1 === step) {
          stepEl.classList.add('active');
        }
      });

      // Atualizar barra de progresso
      const progress = ((step - 1) / (totalSteps - 1)) * 100;
      document.querySelector('.wizard-progress-bar').style.width = `${progress}%`;

      // Controlar botões
      document.getElementById('prevBtn').style.display = step > 1 ? 'flex' : 'none';
      document.getElementById('nextBtn').style.display = step < totalSteps ? 'flex' : 'none';
      document.getElementById('submitBtn').style.display = step === totalSteps ? 'flex' : 'none';
    }

    document.getElementById('nextBtn').addEventListener('click', () => {
      if (currentStep < totalSteps) {
        currentStep++;
        showStep(currentStep);
      }
    });

    document.getElementById('prevBtn').addEventListener('click', () => {
      if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
      }
    });

    // Inicializar o wizard
    showStep(1);
  </script>
<% end %>
